<!DOCTYPE html>
<html lang="en" class="tutorial-layout">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="ROBOTS" content="ALL" />
        <meta name="MSSmartTagsPreventParsing" content="true" />
        <meta name="Copyright" content="" />
        <link rel="stylesheet" href="/assets/css/output.css" >
        <style>
          .tutorial-layout body:not(.gitpod-data-prepper-ready) .gitpod-data-prepper-ready-visible { display: none; }

          .tutorial-layout .gitpod.gitpod-data-prepper-ready .gitpod-data-prepper-ready-visible { display: inherit; }

          .tutorial-layout .gitpod.gitpod-data-prepper-ready .gitpod-data-prepper-ready-hidden { display: none; }

          iframe {
            width: 100%;
            height: 400px;
          }
        </style>

        <title> Data Prepper Demo</title>
        <script src="https://opensearch.org/assets/js/lib/jquery-3.6/jquery-3.6.0.min.js"></script>
        <script src="https://opensearch.org/assets/js/lib/webfontloader/webfontloader.js"></script>

        <script>
            $( document ).ready(function() {
                var gitPodStatus = {};
                // The OpenSearch tutorials in GitPod reveal themselves at a URL that looks like this:
                // 8000-blah-blah-blah.gitpod.io
                // so we check the window location starting with 8, this could be more specific
                // but we really just want to check if we're being served from opensearch.org or not
                if (window.location.host[0] == '8') {
                    $('body').addClass('gitpod');

                    // Dashboards has a strange way of making itself avaliable
                    // there is a script on gitpod that checks for true avaliablity
                    // then adds an empty file, so we can poll it
                    gitPodStatus.dashboardsCheckCount = 0;
                    // check every 2 seconds, clear if we reach a max or once found
                    gitPodStatus.dashboardsInterval = setInterval(function() {
                        // check for 5 minutes
                        if (gitPodStatus.dashboardsCheckCount >= 150) {
                            clearInterval(gitPodStatus.dashboardsInterval);
                        } else {
                            gitPodStatus.dashboardsCheckCount += 1;
                        }
                        jQuery.get('/tutorial/dashboardsready.txt').done(function() { 
                            clearInterval(gitPodStatus.dashboardsInterval);
                            $('body').addClass('gitpod-dashboards-ready');
                        });
                    }, 2000);

                    gitPodStatus.dataPrepperCheckCount = 0;
                    // check every 2 seconds, clear if we reach a max or once found
                    gitPodStatus.dataPrepperInterval = setInterval(function() {
                        // check for 5 minutes
                        if (gitPodStatus.dataPrepperCheckCount >= 250) {
                            clearInterval(gitPodStatus.dataPrepperInterval);
                        } else {
                            gitPodStatus.dataPrepperCheckCount += 1;
                        }
                        jQuery.get('/tutorial/data-prepper-built.txt').done(function() { 
                            clearInterval(gitPodStatus.dataPrepperInterval);
                            $('body').addClass('gitpod-data-prepper-ready');
                        });
                    }, 2000);


                    $('a.gitpod-replace-port').each(function() {
                        var href = $(this).attr('href');
                        var port = $(this).attr('data-port')
                        $(this).attr('href','https://'+window.location.host.replace('8000',port)+'/');
                    });

                    $('code.gitpod-replace-port').each(function() {
                        var text = $(this).text();
                        var port = $(this).attr('data-port')
                        $(this).text('https://'+window.location.host.replace('8000',port)+'/');
                    });


                    $('.gitpod-dashboards').each(function() {
                        $(this).text('https://'+window.location.host.replace('8000','5601')+'/');
                    });

                    $('.gitpod-opensearch').each(function() {
                        $(this).text('https://'+window.location.host.replace('8000','9200')+'/');
                    });
                    
                    let replacementDomain = 'https://opensearch.org';
                    let replacer = function(attr) {
                        return function() { 
                            let hrefValue = $(this).attr(attr); 
                            if (hrefValue[0] === '/') { 
                                $(this).attr(attr, replacementDomain + hrefValue); 
                            }  
                        }
                    };
                    if (location.port !== '4000') {
                        $('link[rel="stylesheet"]').each(replacer('href'));
                        $('img').each(replacer('src'));
                        console.log('not 4000');
                    }
                } else {
                    // not gitpod.
                }
            });
            WebFont.load({
              custom: {
                families: ['FontAwesome'],
              },
              google: {
                families: [
                  'Open Sans Condensed:700',
                  'Open Sans:300italic,400italic,700italic,300,400,700',
                  'Noto Serif:400italic,700italic,400,700',
                  'Fira Mono:400'
                ]
              },
              classes: false,
              events: false,
              timeout: 1000
            });
        </script>


    </head>
    <body >
        <div class="simple-banner">
            <img src="https://opensearch.org/assets/img/opensearch-logo-themed.svg">
        </div>
        <h1>Data Prepper Log Ingestion</h1>
        <hr />

        <h2>Data Pipeline</h2> 
        <img src="Log_Ingestion_FluentBit_DataPrepper_OpenSearch.jpg" class="img-fluid" />

        <hr />

        <h2>Data Prepper Configuration: <code>log_pipeline.yaml</code></h2>
        <iframe src="log_pipeline.txt"></iframe>

        <hr />
        <h2>Status</h2> 
        <p class="gitpod-visible gitpod-dashboards-ready-hidden">üõë OpenSearch Dashboards is starting</p>
        <p class="gitpod-visible gitpod-dashboards-ready-visible">üü¢ OpenSearch Dashboards is ready</p>
        <p class="gitpod-visible gitpod-dashboards-ready-visible">‚û°Ô∏è <a href="http://localhost:5601/" class="gitpod-replace-port" data-port="5601">Launch OpenSearch Dashboards</a>.</p>

        <p class="gitpod-visible gitpod-data-prepper-ready-hidden">üõë OpenSearch Data Prepper is building</p>
        <p class="gitpod-visible gitpod-data-prepper-ready-visible">üü¢ OpenSearch Data Prepper is ready</p>

        <div class="simple-footer">
            &copy; OpenSearch contributors, 2021. OpenSearch is a <a href="/trademark-usage.html">registered trademark</a> of Amazon Web Services.</a> <br /><br />

¬© 2005-2021 <a href="https://www.djangoproject.com/foundation/"> Django Software Foundation</a> and individual contributors. Django is a
<a href="https://www.djangoproject.com/trademarks/">registered trademark</a> of the Django Software Foundation.<br />
This website was forked from the BSD-licensed <a href="https://github.com/django/djangoproject.com/">djangoproject.com</a> originally designed by <a href="https://www.threespot.com">Threespot</a> <span class="ampersand">&amp;</span> <a  href="https://andrevv.com/">andrevv</a>.
        </div>
    </body>

</html>

